{% extends "base.html" %}

{% block content %}
<h2>Trip: {{ trip.destination }}</h2>
<p><strong>Dates:</strong> {{ trip.start_date.strftime('%Y-%m-%d') }} to {{ trip.end_date.strftime('%Y-%m-%d') }}</p>
<p><strong>Notes:</strong> {{ trip.notes }}</p>

<hr>

<!-- ITINERARIES -->
<h3>Itineraries</h3>
<ul>
    {% for itinerary in itineraries %}
    <li>
        <strong>{{ itinerary.title }}</strong>: {{ itinerary.description }}<br>
        {% if itinerary.start_time %}<em>Start:</em> {{ itinerary.start_time.strftime('%Y-%m-%d %H:%M') }}{% endif %}
        {% if itinerary.end_time %} | <em>End:</em> {{ itinerary.end_time.strftime('%Y-%m-%d %H:%M') }}{% endif %}<br>

        <!-- Edit itinerary -->
        <a href="{{ url_for('edit_itinerary', itinerary_id=itinerary.id) }}">Edit</a>

        <!-- Delete itinerary -->
        <form action="{{ url_for('delete_itinerary', itinerary_id=itinerary.id) }}" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this itinerary?');">Delete</button>
        </form>
    </li>
    {% else %}
    <li>No itineraries yet.</li>
    {% endfor %}
</ul>

<!-- Add new itinerary -->
<h4>Add New Itinerary</h4>
<form method="POST" action="{{ url_for('add_itinerary', trip_id=trip.id) }}">
    <label>Title:</label><br>
    <input type="text" name="title" required><br>

    <label>Description:</label><br>
    <input type="text" name="description"><br>

    <label>Start Time:</label><br>
    <input type="time" name="start_time"><br>

    <label>End Time:</label><br>
    <input type="time" name="end_time"><br><br>

    <button type="submit">Add Itinerary</button>
</form>

<hr>

<!-- FILES -->
<h3>Files</h3>
<ul>
    {% for file in files %}
    <li>
        <!-- Use presigned S3 URL -->
        <a href="{{ file.download_url }}" target="_blank">{{ file.file_name }}</a>

        <!-- Delete file -->
        <form action="{{ url_for('delete_file', file_id=file.id) }}" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this file?');">Delete</button>
        </form>
    </li>
    {% else %}
    <li>No files uploaded yet.</li>
    {% endfor %}
</ul>

<!-- Upload new file -->
<h4>Upload File</h4>
<form method="POST" action="{{ url_for('upload_file', trip_id=trip.id) }}" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <button type="submit">Upload</button>
</form>

<hr>
<a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
{% endblock %}
